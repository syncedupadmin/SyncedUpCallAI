"use strict";(()=>{var e={};e.id=552,e.ids=[552],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},7173:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{originalPathname:()=>v,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>d});var n=t(9303),s=t(8716),o=t(670),i=t(9871),c=e([i]);i=(c.then?(await c)():c)[0];let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/reports/value/route",pathname:"/api/reports/value",filename:"route",bundlePath:"app/api/reports/value/route"},resolvedPagePath:"C:\\Users\\nicho\\OneDrive\\Desktop\\SyncedUpCallAI\\src\\app\\api\\reports\\value\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:y}=p,v="/api/reports/value/route";function u(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:d})}r()}catch(e){r(e)}})},9871:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{GET:()=>i});var n=t(7070),s=t(6341),o=e([s]);async function i(){let{rows:e}=await s.db.query(`
    select a.reason_primary,
           count(*) as calls,
           sum(case when p.premium >= 300 then p.premium else 0 end) as lost_value
    from analyses a
    join calls c on c.id=a.call_id
    left join policies_stub p on p.contact_id=c.contact_id and p.status in ('cancelled','refunded','chargeback')
    where c.started_at > now() - interval '30 days'
    group by 1
    order by lost_value desc nulls last, calls desc
  `);return n.NextResponse.json({rows:e})}s=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},6341:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{db:()=>i});var n=t(8678),s=e([n]);let o=new(n=(s.then?(await s)():s)[0]).default.Pool({connectionString:process.env.DATABASE_URL}),i={query:(e,a)=>o.query(e,a),one:async(e,a)=>(await o.query(e,a)).rows[0],oneOrNone:async(e,a)=>(await o.query(e,a)).rows[0]||null,none:async(e,a)=>{await o.query(e,a)}};r()}catch(e){r(e)}})}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[276,972],()=>t(7173));module.exports=r})();