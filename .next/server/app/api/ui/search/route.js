"use strict";(()=>{var e={};e.id=244,e.ids=[244],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},5179:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.r(a),t.d(a,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var r=t(9303),i=t(8716),o=t(670),s=t(5222),c=e([s]);s=(c.then?(await c)():c)[0];let p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/ui/search/route",pathname:"/api/ui/search",filename:"route",bundlePath:"app/api/ui/search/route"},resolvedPagePath:"C:\\Users\\nicho\\OneDrive\\Desktop\\SyncedUpCallAI\\src\\app\\api\\ui\\search\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:h}=p,m="/api/ui/search/route";function d(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}n()}catch(e){n(e)}})},5222:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.r(a),t.d(a,{POST:()=>s});var r=t(7070),i=t(6341),o=e([i]);async function s(e){let{q:a}=await e.json(),t=await fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"text-embedding-3-small",input:a})}),n=(await t.json()).data[0].embedding,{rows:o}=await i.db.query(`
    select c.id, c.started_at, ag.name agent, an.reason_primary, 1 - (embedding <=> $1) as score
    from transcript_embeddings e
    join calls c on c.id=e.call_id
    left join agents ag on ag.id=c.agent_id
    left join analyses an on an.call_id=c.id
    order by e.embedding <=> $1
    limit 50
  `,[n]);return r.NextResponse.json({results:o})}i=(o.then?(await o)():o)[0],n()}catch(e){n(e)}})},6341:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{db:()=>s});var r=t(8678),i=e([r]);let o=new(r=(i.then?(await i)():i)[0]).default.Pool({connectionString:process.env.DATABASE_URL}),s={query:(e,a)=>o.query(e,a),one:async(e,a)=>(await o.query(e,a)).rows[0],oneOrNone:async(e,a)=>(await o.query(e,a)).rows[0]||null,none:async(e,a)=>{await o.query(e,a)}};n()}catch(e){n(e)}})}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[276,972],()=>t(5179));module.exports=n})();